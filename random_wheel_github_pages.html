<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏ß‡∏á‡∏•‡πâ‡∏≠‡∏™‡∏∏‡πà‡∏° (Random Spin Wheel)</title>
  <style>
    :root{
      --bg:#0f172a; /* slate-900 */
      --card:#111827; /* gray-900 */
      --muted:#94a3b8; /* slate-400 */
      --accent:#22c55e; /* green-500 */
    }
    html,body{height:100%}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Noto Sans",sans-serif; background:radial-gradient(1200px 900px at 70% -10%, #1e293b 0%, #0b1223 60%, #070b16 100%); color:white; display:grid; place-items:center;}
    .wrap{width:min(1100px,96vw); display:grid; grid-template-columns:1fr 380px; gap:20px; align-items:center;}
    @media (max-width:900px){.wrap{grid-template-columns:1fr;}}
    .card{background:rgba(255,255,255,.06); backdrop-filter: blur(8px); border:1px solid rgba(255,255,255,.08); border-radius:18px; padding:18px; box-shadow:0 20px 60px rgba(0,0,0,.35)}
    canvas{width:100%; height:auto; display:block}
    h1{margin:0 0 8px; font-weight:800; letter-spacing:.2px}
    .muted{color:var(--muted); font-size:14px}
    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    button, .inputlike{appearance:none; border:none; background:#0b1223; color:white; padding:10px 14px; border-radius:12px; font-weight:600; cursor:pointer; border:1px solid rgba(255,255,255,.12)}
    button.primary{background: linear-gradient(180deg, #2dd4bf, #14b8a6); border:none}
    button:disabled{opacity:.6; cursor:not-allowed}
    .resultBox{font-size:28px; font-weight:800; margin:8px 0 0}
    .chip{display:inline-flex; align-items:center; gap:8px; font-size:12px; background:rgba(255,255,255,.08); padding:6px 10px; border-radius:999px}
    .flex{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .title{font-weight:700; letter-spacing:.2px}
    .options{font-size:13px; line-height:1.6;}
    .optpill{display:inline-block; background:rgba(255,255,255,.08); padding:6px 10px; border-radius:999px; margin:4px 6px 0 0}
    .footer{font-size:12px; color:var(--muted); margin-top:12px}
    a{color:#7dd3fc}
    .arrow{position:absolute; left:50%; top:-6px; transform:translateX(-50%); width:0;height:0;border-left:14px solid transparent; border-right:14px solid transparent; border-bottom:22px solid #fbbf24; filter:drop-shadow(0 4px 6px rgba(0,0,0,.5))}
    .wheelWrap{position:relative}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="wheelWrap">
        <div class="arrow" aria-hidden="true"></div>
        <canvas id="wheel" width="700" height="700" aria-label="‡∏ß‡∏á‡∏•‡πâ‡∏≠‡∏™‡∏∏‡πà‡∏°"></canvas>
      </div>
      <div class="btns">
        <button id="spinBtn" class="primary">üé° ‡∏´‡∏°‡∏∏‡∏ô‡∏ß‡∏á‡∏•‡πâ‡∏≠</button>
        <button id="copyBtn">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</button>
        <button id="resetBtn">‚ôªÔ∏è ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
        <span class="chip">‡∏£‡∏≠‡∏ö‡∏´‡∏°‡∏∏‡∏ô <span id="spins">0</span></span>
      </div>
      <div class="resultBox" id="result">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: -</div>
      <div class="footer" id="callbackHint" style="display:none"></div>
    </div>

    <div class="card">
      <h1 id="title">Random Spin Wheel</h1>
      <div class="muted">‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÉ‡∏ô URL</div>
      <div class="options" id="opts"></div>

      <div class="flex" style="margin-top:10px">
        <span class="title">‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö:</span>
      </div>
      <ul class="muted" style="margin-top:6px">
        <li><code>?items=</code> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ <code>|</code> ‡πÄ‡∏ä‡πà‡∏ô <code>?items=Quiz%201|Quiz%202|+10</code></li>
        <li><code>&weights=</code> ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ <code>|</code> (‡πÄ‡∏ä‡πà‡∏ô <code>3|1|1</code>)</li>
        <li><code>&title=</code> ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏á‡∏•‡πâ‡∏≠</li>
        <li><code>&callback=</code> URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤ (‡πÉ‡∏ä‡πâ <code>{result}</code> ‡πÅ‡∏ó‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå) ‡πÄ‡∏ä‡πà‡∏ô <code>https://example.com/hook?value={result}</code></li>
        <li><code>&autospin=1</code> ‡∏´‡∏°‡∏∏‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤</li>
      </ul>

      <div class="footer">
        ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏£‡πá‡∏ß: ‡πÅ‡∏Å‡πâ <strong>items</strong> ‡πÉ‡∏ô URL ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏≥‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ù‡∏±‡∏á‡πÉ‡∏ô Canva (Apps ‚Üí Embed ‚Üí ‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå) | ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏ö‡∏ô GitHub Pages
      </div>
    </div>
  </div>

  <script>
    // ===== Utilities =====
    const qs = new URLSearchParams(location.search);
    const parseItems = () => {
      const raw = qs.get('items');
      if (!raw) return ["Quiz 1","Quiz 2","Skip","+10","-5"];
      return raw.split('|').map(s=>decodeURIComponent(s.trim())).filter(Boolean);
    };
    const parseWeights = (len) => {
      const raw = qs.get('weights');
      if (!raw) return Array(len).fill(1);
      const arr = raw.split('|').map(x=>Math.max(0, Number(x))); // non-negative
      if (arr.length !== len) return Array(len).fill(1);
      // If all zeros, default to 1
      return arr.some(n=>n>0) ? arr : Array(len).fill(1);
    };
    const weightedPickIndex = (weights) => {
      const total = weights.reduce((a,b)=>a+b,0);
      const r = Math.random()*total;
      let acc = 0;
      for (let i=0;i<weights.length;i++){
        acc += weights[i];
        if (r < acc) return i;
      }
      return weights.length-1;
    };

    // ===== State =====
    const items = parseItems();
    const weights = parseWeights(items.length);
    const colors = items.map((_,i)=> `hsl(${(i*360/items.length)|0} 80% 55%)`);
    const wheel = document.getElementById('wheel');
    const ctx = wheel.getContext('2d');
    const radius = wheel.width/2;
    let angle = -Math.PI/2; // pointer at 12 o'clock
    let spinning = false;
    const storeKey = 'spinStats:'+location.pathname+location.search;
    const stats = JSON.parse(localStorage.getItem(storeKey)||'{}');
    if (!stats.count) stats.count = 0;

    // ===== Draw Wheel =====
    function drawWheel(){
      ctx.clearRect(0,0,wheel.width,wheel.height);
      const cx = radius, cy = radius;
      const totalWeight = weights.reduce((a,b)=>a+b,0);
      let start = 0;
      for (let i=0;i<items.length;i++){
        const slice = (weights[i]/totalWeight) * Math.PI*2;
        ctx.beginPath();
        ctx.moveTo(cx,cy);
        ctx.arc(cx,cy,radius, start+angle, start+slice+angle);
        ctx.closePath();
        ctx.fillStyle = colors[i];
        ctx.fill();
        // Text
        const mid = start + slice/2 + angle;
        ctx.save();
        ctx.translate(cx + Math.cos(mid)*radius*0.65, cy + Math.sin(mid)*radius*0.65);
        ctx.rotate(mid+Math.PI/2);
        ctx.fillStyle = 'white';
        ctx.font = 'bold 22px system-ui';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        const label = items[i];
        ctx.fillText(label.length>18? label.slice(0,18)+'‚Ä¶' : label, 0, 0);
        ctx.restore();
        start += slice;
      }
      // Center circle
      ctx.beginPath();
      ctx.arc(cx,cy,40,0,Math.PI*2);
      ctx.fillStyle = 'rgba(0,0,0,.6)';
      ctx.fill();
    }

    function indexAtPointer(){
      // Map angle to item index by measuring from -90deg (arrow)
      const totalWeight = weights.reduce((a,b)=>a+b,0);
      // Convert to 0..2PI from the base angle
      const rel = ((-angle % (Math.PI*2)) + Math.PI*2) % (Math.PI*2);
      let acc = 0; // in radians
      for (let i=0;i<items.length;i++){
        const slice = (weights[i]/totalWeight) * Math.PI*2;
        if (rel >= acc && rel < acc + slice) return i;
        acc += slice;
      }
      return items.length-1;
    }

    function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

    async function spin(){
      if (spinning) return;
      spinning = true;
      document.getElementById('spinBtn').disabled = true;
      // Preselect target index by weight
      const targetIdx = weightedPickIndex(weights);
      // Compute the angle that puts targetIdx at the arrow (12 o'clock)
      const totalWeight = weights.reduce((a,b)=>a+b,0);
      let start = 0;
      for (let i=0;i<targetIdx;i++) start += (weights[i]/totalWeight)*Math.PI*2;
      const slice = (weights[targetIdx]/totalWeight)*Math.PI*2;
      const targetMid = start + slice/2; // radians from base 0
      const currentRel = ((-angle % (Math.PI*2)) + Math.PI*2) % (Math.PI*2);
      let delta = targetMid - currentRel;
      while (delta < 0) delta += Math.PI*2;
      // Add extra spins for flair
      const extra = Math.PI*2 * (3 + Math.floor(Math.random()*2));
      const totalDelta = delta + extra;
      const duration = 2200 + Math.random()*800; // ms

      const t0 = performance.now();
      function frame(t){
        const p = Math.min(1, (t - t0)/duration);
        const eased = easeOutCubic(p);
        angle = angle - (totalDelta * (eased - easeOutCubic(p-1/60))); // incremental not needed; simplify below
        // Correct approach: compute from start
        angle = - (currentRel + totalDelta*eased);
        drawWheel();
        if (p < 1) {
          requestAnimationFrame(frame);
        } else {
          finalize(targetIdx);
        }
      }
      requestAnimationFrame(frame);
    }

    function finalize(idx){
      const value = items[idx];
      document.getElementById('result').textContent = '‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ' + value;
      stats.count += 1;
      localStorage.setItem(storeKey, JSON.stringify(stats));
      document.getElementById('spins').textContent = stats.count;
      // Update URL hash with result for easy capture
      location.hash = encodeURIComponent(value);
      // If callback is provided, show a hint link
      const cb = qs.get('callback');
      const hint = document.getElementById('callbackHint');
      if (cb){
        const url = cb.replace('{result}', encodeURIComponent(value));
        hint.style.display = 'block';
        hint.innerHTML = 'Callback ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏õ‡∏¥‡∏î: <a href="'+url+'" target="_blank" rel="noopener">'+url+'</a>';
      }
      document.getElementById('spinBtn').disabled = false;
      spinning = false;
    }

    function updateUI(){
      document.getElementById('title').textContent = qs.get('title') || 'Random Spin Wheel';
      document.getElementById('spins').textContent = stats.count;
      const opts = document.getElementById('opts');
      opts.innerHTML = '<div class="flex"><span class="title">Items ('+items.length+')</span></div>' +
        items.map((x,i)=>`<span class="optpill">${i+1}. ${x}</span>`).join('');
    }

    // Buttons
    document.getElementById('spinBtn').addEventListener('click', spin);
    document.getElementById('copyBtn').addEventListener('click', async () => {
      const txt = document.getElementById('result').textContent.replace('‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ','');
      try{ await navigator.clipboard.writeText(txt); }
      catch(e){ /* ignore */ }
    });
    document.getElementById('resetBtn').addEventListener('click', () => {
      stats.count = 0; localStorage.setItem(storeKey, JSON.stringify(stats));
      document.getElementById('spins').textContent = stats.count;
    });

    // Init
    drawWheel();
    updateUI();

    // Auto-spin if requested
    if (qs.get('autospin') === '1') {
      setTimeout(spin, 400);
    }
  </script>
</body>
</html>
